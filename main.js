(()=>{"use strict";function t(t,n,r,o,c){var u=document.querySelector("#card-template").content,i=t.name,a=t.link,l=u.querySelector(".card").cloneNode(!0),s=l.querySelector(".card__image"),d=l.querySelector(".card__title"),p=l.querySelector(".card__delete-button"),f=l.querySelector(".card__like-button"),_=l.querySelector(".card__like-counts");return l.setAttribute("data-card-id",t._id),s.setAttribute("src",a),s.setAttribute("alt",i),d.textContent=i,t.owner._id===n?(p.setAttribute("data-card-id",t._id),p.addEventListener("click",(function(e){r(l,t._id)}))):p.remove(),function(t,e){return e.some((function(e){return e._id===t}))}(n,t.likes)?e(f,_,t.likes.length):_.textContent=t.likes.length,f.addEventListener("click",(function(e){return o(e.target,_,t._id)})),s.addEventListener("click",(function(){return c(i,a)})),l}function e(t,e,n){t.classList.toggle("card__like-button_is-active"),e.textContent=n}function n(t){t.classList.add("popup_is-animated"),setTimeout((function(){return t.classList.add("popup_is-opened")}),0),document.addEventListener("keydown",o)}function r(t){document.removeEventListener("keydown",o),t.classList.remove("popup_is-opened"),setTimeout((function(){return t.classList.remove("popup_is-animated")}),600)}function o(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened"))}function c(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function u(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function i(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){c(t,o,e),o.setCustomValidity(""),u(n,r,e)}))}var a={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-24",headers:{authorization:"7c1f2dae-1abb-4190-8fa4-da81ed7cd155","Content-Type":"application/json"}};function l(t){return t.ok?t.json():Promise.reject(t.status)}function s(t,e){var n=a.baseUrl,r=a.headers,o="";return e&&(o="/avatar"),fetch("".concat(n,"/users/me").concat(o),{method:"PATCH",headers:r,body:JSON.stringify(t)}).then(l)}function d(t,e){var n=a.baseUrl,r=a.headers;return fetch("".concat(n,"/cards/likes/").concat(t),{method:e,headers:r}).then(l)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var f,_,y,m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},v=document.querySelector(".places__list"),h=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),E=document.querySelector(".profile__image"),g=document.querySelector(".popup_type_edit"),L=g.querySelector(".popup__input_type_name"),C=g.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_edit .popup__form"),A=document.querySelector(".popup_type_new-card"),x=A.querySelector(".popup__input_type_card-name"),T=A.querySelector(".popup__input_type_url"),w=A.querySelector(".popup__form"),U=document.querySelector(".popup_type_image"),j=U.querySelector(".popup__image"),B=U.querySelector(".popup__caption"),O=document.querySelector(".popup_type_new-avatar"),D=O.querySelector(".popup__form"),P=O.querySelector(".popup__input_type_avatar-link"),M=document.querySelector(".popup_type_confirm"),I=M.querySelector(".popup__button"),N=document.querySelectorAll(".popup__close"),V=document.querySelectorAll(".popup");function G(t){b.textContent=t.name,q.textContent=t.about,E.setAttribute("style","background-image: url(".concat(t.avatar,");"))}function J(t){"Сохранить"===t.textContent?t.textContent="Сохранение...":t.textContent="Сохранить"}function z(t){console.log("Error: ".concat(t))}function H(t,e){n(M),f=function(){(function(t,e){return function(t){var e=a.baseUrl,n=a.headers;return fetch("".concat(e,"/cards/").concat(t),{method:"DELETE",headers:n}).then(l)}(e).then((function(){!function(t){t.remove()}(t)})).catch(z)})(t,e).then((function(){r(M)}))}}function $(t,n,r){!function(t){return t.classList.contains("card__like-button_is-active")}(t)?d(r,"PUT").then((function(r){e(t,n,r.likes.length)})).catch(z):d(r,"DELETE").then((function(r){e(t,n,r.likes.length)})).catch(z)}function F(t,e){n(U),j.setAttribute("src",e),j.setAttribute("alt",t),B.textContent=t}I.addEventListener("click",(function(){return f()})),Promise.all([(_=a.baseUrl,y=a.headers,fetch("".concat(_,"/users/me"),{method:"GET",headers:y}).then(l)),function(){var t=a.baseUrl,e=a.headers;return fetch("".concat(t,"/cards"),{method:"GET",headers:e}).then(l)}()]).then((function(e){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];G(c),u.forEach((function(e){v.append(t(e,c._id,H,$,F))}))})).catch(z),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);u(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?c(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(t,e,e.validationMessage,n)}(t,o,e),u(n,r,e)}))}))}(e,t)}))}(m),h.addEventListener("click",(function(){L.value=b.textContent,C.value=q.textContent,i(k,m),n(g)})),k.addEventListener("submit",(function(t){t.preventDefault();var e={name:L.value,about:C.value};J(t.target.querySelector("button")),s(e,!1).then((function(t){G(t),r(g)})).catch(z).finally((function(){J(t.target.querySelector("button"))}))})),S.addEventListener("click",(function(){n(A),w.reset(),i(w,m)})),w.addEventListener("submit",(function(e){e.preventDefault();var n={name:x.value,link:T.value};J(e.target.querySelector("button")),function(t){var e=a.baseUrl,n=a.headers;return fetch("".concat(e,"/cards"),{method:"POST",headers:n,body:JSON.stringify(t)}).then(l)}(n).then((function(e){var n=t(e,e.owner._id,H,$,F);v.prepend(n),r(A),w.reset()})).catch(z).finally((function(){J(e.target.querySelector("button"))}))})),E.addEventListener("click",(function(){n(O),D.reset(),i(D,m)})),D.addEventListener("submit",(function(t){t.preventDefault();var e={avatar:P.value};J(t.target.querySelector("button")),s(e,!0).then((function(t){G(t),r(O)})).catch(z).finally((function(){J(t.target.querySelector("button"))}))})),N.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return r(e)}))})),V.forEach((function(t){t.addEventListener("click",(function(t){t.target.classList.contains("popup")&&r(t.target)}))}))})();